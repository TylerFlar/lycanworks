<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gallery Test</title>
  <style>
    :root {
      color-scheme: dark light;
      font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
      background-color: #111;
      color: #f4f4f4;
      line-height: 1.6;
    }

    body {
      margin: 0;
      padding: 2rem;
      background: radial-gradient(circle at top, rgba(60, 64, 67, 0.35), transparent 60%), #111;
    }

    h1 {
      margin: 0 0 1.5rem;
      font-size: clamp(1.8rem, 4vw, 2.6rem);
      text-align: center;
      letter-spacing: 0.04em;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .card {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 12px 30px -18px rgba(0, 0, 0, 0.7);
      transition: transform 160ms ease, border-color 160ms ease;
    }

    .card:hover,
    .card:focus-within {
      transform: translateY(-4px);
      border-color: rgba(255, 255, 255, 0.18);
    }

    .media-button {
      position: relative;
      border: none;
      padding: 0;
      margin: 0;
      background: none;
      cursor: pointer;
    }

    .media-button img {
      display: block;
      width: 100%;
      height: auto;
      aspect-ratio: 16 / 9;
      object-fit: cover;
      background: #1f1f1f;
      transition: filter 140ms ease;
    }

    .card:hover .media-button img,
    .card:focus-within .media-button img {
      filter: brightness(1.05) saturate(1.05);
    }

    .card-content {
      padding: 0.85rem 1.1rem 1.1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .feature-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.25rem;
    }

    .feature {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: rgba(255, 255, 255, 0.72);
    }

    dialog {
      border: none;
  border-radius: 20px;
  padding: 0;
      max-width: min(90vw, 1100px);
      width: 100%;
      background: rgba(22, 24, 27, 0.96);
      color: #fdfdfd;
      box-shadow: 0 35px 55px -30px rgba(0, 0, 0, 0.75);
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, 0.72);
      backdrop-filter: blur(2px);
    }

    .lightbox__media img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 20px 20px 0 0;
    }

    .lightbox__close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(0, 0, 0, 0.52);
      color: inherit;
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .gif-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      border: none;
      background: rgba(0, 0, 0, 0.65);
      color: #fff;
      padding: 0.45rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: none;
    }

    .card.is-playing .gif-close {
      display: inline-flex;
    }

    .card.is-playing .media-button img {
      outline: 3px solid rgba(255, 255, 255, 0.25);
    }

    @media (max-width: 600px) {
      body {
        padding: 1.5rem 1rem;
      }

      .card-content {
        padding: 0.9rem 1rem 1.1rem;
      }
    }
  </style>
</head>
<body>
  <h1>Gallery Manifest Preview</h1>
  <ul class="gallery" id="gallery" aria-live="polite"></ul>

  <dialog id="lightbox" aria-modal="true">
    <button type="button" class="lightbox__close" id="lightboxClose">Close</button>
    <div class="lightbox__media">
      <img id="lightboxImage" src="" alt="" loading="lazy">
    </div>
  </dialog>

  <script>
    const manifestItems = [
      {
        id: "hero-wolf-pack-dusk",
        type: "image",
        files: {
          image: "../assets/img/hero-wolf-pack-dusk.webp",
          thumb: "../assets/img/thumb-wolf-pack-dusk.webp"
        },
        features: ["wolf", "dusk", "hero", "pack"],
        alt: "Three wolves howl on a cliff at dusk, side view."
      },
      {
        id: "poster-wolf-pack-path",
        type: "image",
        files: {
          image: "../assets/img/poster-wolf-pack-path.webp",
          thumb: "../assets/img/thumb-wolf-pack-path.webp"
        },
        features: ["wolf", "poster", "trail"],
        alt: "Poster of wolves along a forest path, front view."
      },
      {
        id: "habitat-observatory-night",
        type: "image",
        files: {
          image: "../assets/img/habitat-observatory-night.webp",
          thumb: "../assets/img/thumb-habitat-observatory-night.webp"
        },
        features: ["observatory", "night", "concept"],
        alt: "Observatory dome under aurora, angled overhead view."
      },
      {
        id: "ui-sigil-engraving",
        type: "image",
        files: {
          image: "../assets/img/ui-sigil-engraving.webp",
          thumb: "../assets/img/thumb-ui-sigil-engraving.webp"
        },
        features: ["sigil", "ui", "texture"],
        alt: "Engraved sigil on steel plate, macro top view."
      },
      {
        id: "loop-wolf-trail-sign",
        type: "gif",
        files: {
          gif: "../assets/gif/loop-wolf-trail-sign.gif",
          poster: "../assets/gif/poster-wolf-trail-sign.webp",
          thumb: "../assets/gif/thumb-wolf-trail-sign.webp"
        },
        features: ["trail-sign", "snow", "loop"],
        alt: "Trail sign flickers while snow blows toward camera."
      },
      {
        id: "motion-fenrir-howl",
        type: "gif",
        files: {
          gif: "../assets/gif/motion-fenrir-howl.gif",
          poster: "../assets/gif/poster-motion-fenrir-howl.webp",
          thumb: "../assets/gif/thumb-motion-fenrir-howl.webp"
        },
        features: ["fenrir", "howl", "animation", "hero"],
        alt: "Fenrir statue glows as head rises to howl, side view."
      }
    ];

    const gallery = document.getElementById("gallery");
    const lightbox = document.getElementById("lightbox");
    const lightboxImage = document.getElementById("lightboxImage");
    const lightboxClose = document.getElementById("lightboxClose");

    const playingCards = new Set();

    manifestItems.forEach((item) => {
      const card = document.createElement("li");
      card.className = "card";
      card.dataset.type = item.type;
      card.dataset.id = item.id;
      card.__item = item;

      const mediaButton = document.createElement("button");
      mediaButton.type = "button";
      mediaButton.className = "media-button";
  mediaButton.setAttribute("aria-label", `${item.alt}`);

      const previewImage = document.createElement("img");
      previewImage.loading = "lazy";
      previewImage.alt = item.alt;

      if (item.type === "image") {
        previewImage.src = item.files.thumb;
        mediaButton.addEventListener("click", () => openLightbox(item));
      } else {
        previewImage.src = item.files.poster || item.files.thumb;
        previewImage.dataset.poster = previewImage.src;
        mediaButton.addEventListener("click", () => toggleGif(card));

        const gifClose = document.createElement("button");
        gifClose.type = "button";
        gifClose.className = "gif-close";
        gifClose.textContent = "Close";
        gifClose.addEventListener("click", (event) => {
          event.stopPropagation();
          stopGif(card);
        });
        mediaButton.appendChild(gifClose);
      }

      mediaButton.appendChild(previewImage);
      card.appendChild(mediaButton);

      const content = document.createElement("div");
      content.className = "card-content";

      const featureRow = document.createElement("div");
      featureRow.className = "feature-row";
      item.features.forEach((feature) => {
        const featureEl = document.createElement("span");
        featureEl.className = "feature";
        featureEl.textContent = feature;
        featureRow.appendChild(featureEl);
      });

      content.appendChild(featureRow);
      card.appendChild(content);

      gallery.appendChild(card);
    });

    function openLightbox(item) {
      lightboxImage.src = item.files.image;
      lightboxImage.alt = item.alt;
      lightbox.showModal();
      lightboxClose.focus();
    }

    function closeLightbox() {
      if (lightbox.open) {
        lightbox.close();
        lightboxImage.src = "";
      }
    }

    lightboxClose.addEventListener("click", closeLightbox);

    lightbox.addEventListener("click", (event) => {
      if (event.target === lightbox) {
        closeLightbox();
      }
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        closeLightbox();
        playingCards.forEach((card) => stopGif(card));
      }
    });

    function toggleGif(card) {
      if (card.dataset.playing === "true") {
        stopGif(card);
      } else {
        playGif(card);
      }
    }

    function playGif(card) {
      const item = card.__item;
      const img = card.querySelector("img");
      card.dataset.playing = "true";
      card.classList.add("is-playing");
      playingCards.add(card);
      img.dataset.poster = img.dataset.poster || (item.files.poster || item.files.thumb);
      img.alt = `${item.alt} (animated)`;
      img.src = item.files.gif;
    }

    function stopGif(card) {
      const item = card.__item;
      const img = card.querySelector("img");
      card.dataset.playing = "false";
      card.classList.remove("is-playing");
      playingCards.delete(card);
      const poster = img.dataset.poster || item.files.poster || item.files.thumb;
      img.src = poster;
      img.alt = item.alt;
    }
  </script>
</body>
</html>
